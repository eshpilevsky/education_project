<div class="container">
  <div class="row justify-content-center">
    <div class="col-md-10">
      <div *ngIf="!register && submitSuccess" class="alert alert-success text-center">
        Ваш профиль был успешно обновлен.
      </div>
      <div *ngIf="register && submitSuccess" class="alert alert-success text-center">
        Мы получили вашу регистрацию и сейчас проверяем ее.
      </div>
      <div *ngIf="error" class="alert alert-danger text-center">
        {{ error | json }}
      </div>
    </div>
  </div>

  <div class="row justify-content-center">
    <div class="col-md-10">
      <form #studentForm [formGroup]="registerForm" (ngSubmit)="onSubmit()">
        <div class="form-row">
          <div class="col-md-6">
            <div class="form-label-group">
              <input
                type="text"
                class="form-control"
                name="first-name"
                id="first-name"
                placeholder="Имя"
                formControlName="firstName"
              />
              <label for="first-name">Имя</label>
              <div class="invalid-feedback">
                <div *ngIf="f.firstName.errors?.required">
                  Вы должны указать имя
                </div>
              </div>
            </div>
          </div>

          <div class="col-md-6">
            <div class="form-label-group">
              <input
                type="email"
                name="email"
                id="email"
                placeholder="E-Mail"
                class="form-control"
                formControlName="email"
              />
              <label for="email">E-Mail</label>
              <div class="invalid-feedback">
                <div *ngIf="f.email.errors?.required">
                  Вы должны ввести адрес электронной почты
                </div>
                <div *ngIf="f.email.errors?.email">
                  Это почта недействительно
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="form-row">
          <div class="col-md-6">
            <div class="form-group">
              <p>Пол</p>

              <div
                *ngFor="let gender of genders"
                class="custom-control custom-radio custom-control-inline"
              >
                <input
                  class="custom-control-input"
                  type="radio"
                  [value]="gender.shortcode"
                  id="gender-{{ gender.shortcode }}"
                  formControlName="gender"
                />
                <label
                  class="custom-control-label"
                  for="gender-{{ gender.shortcode }}"
                  >{{ gender.gender }}</label
                >
              </div>
              <!-- bootstrap will only display .invalid-feedback next to .is-invalid object -->
              <!-- HACK: -->
              <span
                *ngIf="submitted && f.gender.errors"
                class="is-invalid"
              ></span>
              <div class="invalid-feedback">
                <div *ngIf="f.gender.errors?.required">
                  Вы должны выбрать пол
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group col-md-6">
            <label for="state">Государство</label>
            <select
              name="state"
              class="form-control custom-select"
              formControlName="state"
            >
              <option *ngFor="let state of states" [value]="state.id">
                {{ state.name }}
              </option>
            </select>
            <div class="invalid-feedback">
              <div *ngIf="f.state.errors?.required">
                Вы должны войти в состояние
              </div>
            </div>
          </div>
        </div>

        <div class="form-row mb-4">
          <div class="col-sm-4 col-md-6">
            <label for="school-type">Тип школы</label>
            <select
              name="school-type"
              class="form-control custom-select"
              formControlName="schoolType"
              (change)="refreshSliderOptions()"
            >
              <option
                *ngFor="let schoolType of schoolTypes"
                [value]="schoolType.id"
              >
                {{ schoolType.name }}
              </option>
            </select>
            <div class="invalid-feedback">
              <div *ngIf="f.schoolType.errors?.required">
                Вы должны указать тип школы
              </div>
            </div>
          </div>

          <div class="col-sm-8 col-md-6">
            <label for="class">Уровень оценки</label>
            <!-- isBrowser: https://github.com/angular-slider/ng5-slider/issues/66-->
            <div *ngIf="isBrowser" class="custom-slider">
              <ng5-slider
                [options]="options"
                formControlName="slider"
                [manualRefresh]="sliderRefresh"
              ></ng5-slider>
            </div>
          </div>
        </div>

        <p *ngIf="register">Придумайте пароль (не менее 8 символов)</p>
        <p *ngIf="!register">Изменить пароль (не менее 8 символов)</p>
        <div class="form-row">
          <div class="col-md">
            <div class="form-group form-label-group">
              <input
                type="password"
                formControlName="password"
                class="form-control"
                placeholder="Пароль"
                [required]="register"
              />
              <label for="password">Пароль</label>
              <div class="invalid-feedback">
                <div *ngIf="registerForm.errors?.passwordNotMatch">
                  Два пароля должны совпадать.
                </div>
                <div *ngIf="f.password.errors?.required">
                  Вы должны предоставить пароль
                </div>
                <div *ngIf="f.password.errors?.minlength">
                  Ваш пароль должен быть как минимум
                  {{ f.password.errors.minlength.requiredLength }} длинны
                </div>
              </div>
            </div>
          </div>
          <div class="col-md">
            <div class="form-group form-label-group">
              <input
                type="password"
                formControlName="passwordRepeat"
                class="form-control"
                placeholder="Passwort wiederholen"
                [required]="register"
              />
              <label for="passwordRepeat">Повторить пароль</label>
              <div class="invalid-feedback">
                <div *ngIf="registerForm.errors?.passwordNotMatch">
                  Два пароля должны совпадать.
                </div>
                <div *ngIf="f.passwordRepeat.errors?.required">
                  Вы должны предоставить пароль
                </div>
                <div *ngIf="f.passwordRepeat.errors?.minlength">
                  Ваш пароль должен быть как минимум
                  {{ f.passwordRepeat.errors.minlength.requiredLength }} длинны
                </div>
              </div>
            </div>
          </div>
        </div>
        <div *ngIf="register" class="form-group form-row my-3">
          <div class="custom-control custom-checkbox">
            <input
              type="checkbox"
              id="terms"
              formControlName="terms"
              class="custom-control-input"
            />
            <label for="terms" class="custom-control-label"
              >Я принимаю условия
              <a routerLink="/terms" target="_blank">Правила и положения</a> и
              <a routerLink="/privacy" target="_blank">Защита данных</a>
            </label
            >
            <div class="invalid-feedback">
              <div *ngIf="f.terms.errors?.required">
                Вы должны принять условия.
              </div>
            </div>
          </div>
        </div>

        <button
          type="submit"
          class="btn btn-primary"
          [disabled]="(submitSuccess && register) || loading"
        >
          <span
            *ngIf="loading"
            class="spinner-border spinner-border-sm mr-1"
          ></span>
          Зарегистрироваться
        </button>
      </form>
    </div>
  </div>
</div>
